<!--
Element providing the library chat component

##### Example

    <uqlibrary-chat></uqlibrary-chat>
@element uqlibrary-chat
@blurb Element providing the library chat
@status alpha
@homepage http://uqlibrary.github.io/uqlibrary-chat
-->

<link rel="import" href="../uqlibrary-elements/0.5.4/lib/vulcanized.html">


<polymer-element name="uqlibrary-chat" layout center attributes="chatId chatIId chatHash">
  <template>
    <style>
      iframe {
        height: 250px;
      }
    </style>
    <link rel="stylesheet" href="../uqlibrary-elements/resources/theme/element.css">

    <uqlibrary-ga id="ga" appName="chat"></uqlibrary-ga>
    <uqlibrary-api-account id="account"></uqlibrary-api-account>
    <core-drawer-panel id="drawerPanel" class="drawer" drawerWidth="256px" responsiveWidth="768px">
      <core-header-panel drawer>
        <uqlibrary-menu account="{{user}}"></uqlibrary-menu>
      </core-header-panel>

      <core-header-panel main class="main">
        <core-toolbar>
          <paper-icon-button id="toolBarLeftButton" icon="menu" core-drawer-toggle></paper-icon-button>
          <span flex id="toolbar-page-title">Ask the Library</span>

        </core-toolbar>

        <div id="content">
            <paper-shadow class="card" z="1">
              <iframe flex id="iframe_{{chatHash}}"
                      frameborder="0"
                      scrolling="no"
                  ></iframe>
            </paper-shadow>
            <paper-shadow class="card" z="0">
              <uqlibrary-contacts></uqlibrary-contacts>
            </paper-shadow>
        </div>
      </core-header-panel>

    </core-drawer-panel>

  </template>

  <script>

    (function () {
      Polymer('uqlibrary-chat', {
        chatStatus: false,
        chatUrl: '',
        publish: {
          chatId: '',
          chatIId: '',
          chatHash: ''
        },
        ready: function () {

          this.chatUrl = "//v2.libanswers.com/chati.php?iid=" + this.chatIId + "&hash=" + this.chatHash;
          this.$['iframe_' + this.chatHash].setAttribute('src', this.chatUrl);

          var that = this;
          this.$.account.addEventListener('uqlibrary-api-account-loaded', function (e) {
            if (e.detail.hasSession) {
              that.user = e.detail;
            }
          });

          this.$.account.get();

        }
      });
    })();
  </script>

</polymer-element>